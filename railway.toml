[build]
builder = "nixpacks"
buildCommand = "pnpm install --frozen-lockfile && NODE_NO_WARNINGS=1 pnpm run build"
# Removed watchPaths - let Railway use defaults (watches entire repo)
# If watchPaths is set in Railway dashboard UI, it will override this file
# Explicitly disable metal build environment to ensure deployments trigger
nixpacksPlan = "./nixpacks.toml"

[deploy]
startCommand = "pnpm start"
healthcheckPath = "/api/health"
healthcheckTimeout = 5
healthcheckInterval = 5
restartPolicyType = "on_failure"
# Force deployment by ensuring changes are detected
# Note: Railway CLI 'railway up' bypasses "Wait for CI" setting

# Cron job for daily reset at midnight
[[cron]]
schedule = "0 0 * * *"
command = "curl -X POST -H 'Authorization: Bearer $CRON_SECRET' $RAILWAY_PUBLIC_DOMAIN/api/cron/daily-reset"