[build]
builder = "nixpacks"
buildCommand = "pnpm install --frozen-lockfile && NODE_NO_WARNINGS=1 pnpm run build"
# Removed watchPaths - let Railway use defaults (watches entire repo)
# If watchPaths is set in Railway dashboard UI, it will override this file

# IMPORTANT: Metal builds must be DISABLED in Railway Dashboard
# Metal builds are NOT ready for production and will cause deployments to be skipped
# To disable: Go to Railway Dashboard > Settings > Build > Turn OFF "Metal Builds"
# This cannot be controlled via config files - it's a dashboard-only setting

[deploy]
startCommand = "pnpm start"
healthcheckPath = "/api/health"
healthcheckTimeout = 5
healthcheckInterval = 5
restartPolicyType = "on_failure"
# Force deployment by ensuring changes are detected
# Note: Railway CLI 'railway up' bypasses "Wait for CI" setting

# Cron job for daily reset at midnight
[[cron]]
schedule = "0 0 * * *"
command = "curl -X POST -H 'Authorization: Bearer $CRON_SECRET' $RAILWAY_PUBLIC_DOMAIN/api/cron/daily-reset"