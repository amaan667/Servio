[build]
builder = "nixpacks"
buildCommand = "pnpm install --frozen-lockfile && NODE_NO_WARNINGS=1 pnpm run build"
watchPatterns = ["**/*.ts", "**/*.tsx", "**/*.js", "**/*.jsx", "**/*.css", "**/*.json", "**/*.toml", "**/*.md"]

# Ensure Railway detects changes and triggers deployment

[deploy]
# Use PORT environment variable that Railway provides automatically
startCommand = "pnpm start"
healthcheckPath = "/api/health"
# Reduced timeout for faster failure detection - health endpoint must respond quickly
healthcheckTimeout = 30
healthcheckInterval = 5
restartPolicyType = "on_failure"

# Cron job for daily reset at midnight
[[cron]]
schedule = "0 0 * * *"
command = "curl -X POST -H 'Authorization: Bearer $CRON_SECRET' $RAILWAY_PUBLIC_DOMAIN/api/cron/daily-reset"