["middleware.ts`](../middleware.ts))\n- **Mobile Browser Detection**: Detects iOS Safari and Android Chrome via User-Agent\n- **Permissive Cookie Settings**:\n  - `sameSite: \"lax", "for mobile, `\"strict", "for desktop\n  - `httpOnly: false` (required for Supabase to read cookies)\n  - `secure: true` based on actual HTTPS protocol\n  - `maxAge: 7 days` for persistence\n- **RPC Fallback**: Always sets default tier/role headers when RPC fails\n- **Authorization Header Support**: Accepts Bearer tokens from client-side localStorage\n\n### 2. Mobile Storage Fallback ([`lib/access/useAccessContext.ts`](../lib/access/useAccessContext.ts))\n- Tests sessionStorage/localStorage availability\n- Falls back to cookies when storage APIs fail\n- Handles private browsing mode gracefully\n\n### 3. Default Context on Errors ([`lib/access/getAccessContext.ts`](../lib/access/getAccessContext.ts))\n- Returns default AccessContext instead of null on errors\n- Prevents \"access denied", "when RPC fails intermittently\n\n### 4. Enhanced API Client ([`lib/api-client.ts`](../lib/api-client.ts))\n- Multiple fallback strategies for auth token retrieval\n- Session refresh on token expiration\n- Authorization header support\n\n## Deployment Status\n\n### \u2705 Code Changes\n- All changes committed and pushed to `main` branch\n- Lint passes (0 warnings)\n- Typecheck passes (0 errors)\n- Build succeeds\n\n### \u26a0\ufe0f Railway Deployment\nThe GitHub Actions workflow for Railway deployment may not be triggering because:\n1. GitHub secrets `RAILWAY_TOKEN` and `RAILWAY_SERVICE_NAME` may not be set\n2. The workflow requires these secrets to authenticate with Railway\n\n### \ud83d\udd27 Setup Instructions\n\n#### Option 1: Enable GitHub Actions Deployment\n1. Go to your GitHub repository settings:\n   ```\n   https://github.com/amaan667/Servio/settings/secrets/actions\n   ```\n\n2. Add the following secrets:\n   - **RAILWAY_TOKEN**: Get it from https://railway.app/account/tokens\n   - **RAILWAY_SERVICE_NAME**: Your Railway service name (e.g., \"servio-web\")\n\n3. Push to main branch to trigger deployment\n\n#### Option 2: Manual Deployment\n```bash\n# Install Railway CLI\nnpm install -g @railway/cli\n\n# Login\nrailway login\n\n# Deploy\nrailway up --service=<your-service-name>\n```\n\n#### Option 3: Verify Deployment Status\n```bash\n# Run the verification script\n./scripts/verify-railway-deploy.sh\n```\n\n## Testing on Mobile\n\n### Steps to Verify the Fix\n1. Clear browser cookies and cache on mobile\n2. Open the application on mobile (iOS Safari or Android Chrome)\n3. Log in\n4. Navigate to KDS page\n5. Navigate to Analytics page\n6. Verify no \"access denied\" errors appear\n\n### Expected Behavior\n- Cookies should persist for 7 days\n- Authentication should work on both iOS Safari and Android Chrome\n- Private browsing mode should still work (with cookie fallback)\n- No \"access denied\" errors on KDS or analytics pages\n\n## Troubleshooting\n\n### If Mobile Still Shows \"Access Denied", 1.0, "Check Console Logs**: Look for cookie-related errors\n2. **Verify Cookie Settings**: Use browser DevTools to inspect cookies\n3. **Test Different Browsers**: Try Chrome, Safari, Firefox\n4. **Check Network Requests**: Verify RPC calls are succeeding\n\n### Common Issues\n- **Cookies not persisting**: Check if `maxAge` is set correctly\n- **RPC failing**: Check if `get_access_context` function exists in database\n- **Session expiring**: Check if token refresh is working\n\n## Files Modified\n\n1. [`middleware.ts`](../middleware.ts) - Mobile-optimized cookie settings\n2. [`lib/access/useAccessContext.ts`](../lib/access/useAccessContext.ts) - Mobile storage fallback\n3. [`lib/access/getAccessContext.ts`](../lib/access/getAccessContext.ts) - Default context on errors\n4. [`lib/api-client.ts`](../lib/api-client.ts) - Enhanced auth token handling\n5. [`lib/supabase/index.ts`](../lib/supabase/index.ts) - Cookie maxAge settings\n\n## Next Steps\n\n1. **Set up GitHub secrets** for Railway deployment\n2. **Test on actual mobile devices** to verify the fix\n3. **Monitor error logs** for any remaining issues\n4. **Consider adding mobile-specific logging** for debugging\n\n## References\n\n- [Supabase SSR Authentication](https://supabase.com/docs/guides/auth/server-side/nextjs)\n- [iOS Safari Cookie Policy](https://webkit.org/blog/10218/full-third-party-cookie-blocking-and-more/)\n- [Railway Deployment Guide](https://docs.railway.app/deploy)"]